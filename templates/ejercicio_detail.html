{% extends 'base.html' %}

{% block title %}{{ ejercicio.nombre }} - FitGuide{% endblock %}

{% block content %}
<section class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h1>{{ ejercicio.nombre }}</h1>
            <p class="text-muted">Publicado por {% if ejercicio.author %}{{ ejercicio.author.username }}{% else %}Anónimo{% endif %}</p>
            <p class="ejercicio-muscles"><strong>Músculos trabajados:</strong> {{ ejercicio.musculos_trabajados }}</p>
            <div class="ejercicio-body mt-3">{{ ejercicio.descripcion|linebreaks }}</div>

            {# Imagen colocada después del cuerpo de la publicación #}
            {% if ejercicio.imagen %}
                <img src="{{ ejercicio.imagen.url }}" alt="{{ ejercicio.nombre }}" class="img-fluid mt-3">
            {% elif ejercicio.imagen_url %}
                <img src="{{ ejercicio.imagen_url }}" alt="{{ ejercicio.nombre }}" class="img-fluid mt-3">
            {% endif %}
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Grupo muscular</h5>
                    <p><a href="{{ ejercicio.grupo_muscular.get_absolute_url }}">{{ ejercicio.grupo_muscular.nombre }}</a></p>
                    {% if user.is_authenticated and ejercicio.author == user %}
                        <a href="{% url 'ejercicio_editar' ejercicio.pk %}" class="btn btn-sm btn-primary">Editar</a>
                        <a href="{% url 'ejercicio_eliminar' ejercicio.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
<section class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h4>Comentarios</h4>

            {% if user.is_authenticated %}
            <form action="{% url 'comentario_nuevo' ejercicio.pk %}" method="post" class="mb-4">
                {% csrf_token %}
                <div class="mb-2">
                    <textarea name="content" rows="3" class="form-control" placeholder="Escribe un comentario..."></textarea>
                </div>
                <button class="btn btn-primary btn-sm">Comentar</button>
            </form>
            {% else %}
            <p><a href="{% url 'login' %}?next={{ request.path }}">Inicia sesión</a> para comentar.</p>
            {% endif %}

            <div class="list-group">
                {% for comentario in ejercicio.comentarios.all %}
                <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">{{ comentario.author.username }}</h6>
                        <small class="text-muted">{{ comentario.created_at|date:"d M Y H:i" }}</small>
                    </div>
                    <p class="mb-1">{{ comentario.content|linebreaks }}</p>
                    {% if user == comentario.author %}
                    <small>
                        <a href="{% url 'comentario_editar' comentario.pk %}" class="me-2">Editar</a>
                        <a href="{% url 'comentario_eliminar' comentario.pk %}" class="text-danger">Eliminar</a>
                    </small>
                    {% endif %}
                </div>
                {% empty %}
                <p>No hay comentarios todavía.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
